{% load satchmo.currency_filter %}
{% extends "base.html" %}

{% block navbar %}
<a href="{{shop_base}}/">Home</a> ::
Checkout
{% endblock %}

{% block content %}
<h3>Checkout</h3>
<div id="checkoutprogress">
<ul>
    <li class="first"><a href="{% url satchmo_checkout-step1 %}">Ship/Bill</a></li>
    <li><a href="{% url satchmo_checkout-step2 %}">Payment</a></li>
    <li class="active">Confirmation</li>
</ul>
</div>
{% if errors %}
    <h3>The following error was returned while trying to process your card.  Please correct and resubmit</h3>
    {{ errors }}
{% else %}
    <h3>Please validate the following information, then submit your order.</h3>
{% endif %}
<h4>Items Ordered</h4>
{% for item in order.orderitem_set.all %}
{{ item }} - {{item.unitPrice|currency}} x {{item.quantity}} = {{item.lineItemPrice|currency}}<br/>
{% endfor %}

<h4>Contact Information</h4>
{{ order.contact.full_name }}<br/>
{{ order.contact.email }}<br/>
{{ order.contact.primary_phone.phone }}<br/>

<h4>Billing Information</h4>
{{ order.fullBillStreet }}<br/>
{{ order.billCity }} <br/>
{{ order.billState }}<br/>
{{ order.billPostalCode }}<br/>
{{ order.billCountry }}<br/>

<h4>Shipping Address</h4>
{{ order.fullShipStreet }}<br/>
{{ order.shipCity }}<br/>
{{ order.shipState }}<br/>
{{ order.shipPostalCode }}<br/>
{{ order.shipCountry }}<br/>
<h4>Shipping Method</h4>
{{ order.shippingDescription }}<br/>
{{ order.shippingMethod }} <br/>
{{ order.shippingCost|currency }} <br/>

<h4>Total</h4>
{% if order.discount %}
    Discount - {{order.discount|currency}}<br/>
{% endif %}
Shipping + {{order.shippingCost|currency}}<br/>
{% if order.tax %}
    Tax + {{order.tax|currency}}<br/>
{% endif %}
Total = {{order.total|currency}}<br/>

<h4>Payment</h4>
Your payment will be processed through PayPal.

<form action="{{ post_url }}" method="post">
<input type="hidden" name="cmd" value="_cart" />
<input type="hidden" name="upload" value="1" />
<input type="hidden" name="business" value="{{ business }}" /> 
<input type="hidden" name="currency_code" value="{{ currency_code }}" />
<input type="hidden" name="no_shipping" value="1" />
<input type="hidden" name="return" value="{{ return_address }}" />
{% for item in order.orderitem_set.all %}
<input type="hidden" name="item_name_{{forloop.counter}}" value="{{item}}" />
<input type="hidden" name="amount_{{forloop.counter}}" value="{{item.unitPrice}}" />
<input type="hidden" name="quantity_{{forloop.counter}}" value="{{item.quantity}}" />
{% endfor %}
<input type="hidden" name="shipping_1" value="{{order.shippingCost}}" />
<input type="hidden" name="tax_cart" value="{{order.tax}}" />
<input type="submit" value="Purchase Items" />
</form>

{% endblock %}
