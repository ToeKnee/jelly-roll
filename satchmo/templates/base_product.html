{% extends "base.html" %}
{% load i18n %}
{% load satchmo.thumbnail %}
{% load satchmo.price_display %}
{% load satchmo.currency_filter %}

{% block extra-head %}
{% if product.meta %}
    <meta name="description" content="{{product.meta}}">
{% endif %}

<script type="text/javascript" src="{{media_url}}jquery-latest.pack.js"></script>
<script type="text/javascript">
function setNamePrice(json){
    [name, price] = eval(json);
    if (name){
        setName(name);
    }
    setPrice(price);
}
function setName(name){
    $("#productname").attr('value', name);
}
function setPrice(price){
    $("#price").text(price);
}

function getPrice(){
    opts = {};
    price_options = $("form#options").find("select");
    for (a=0; a<price_options.length; a++){
        opts[price_options[a].name] = price_options[a].value;
    }
    opts["quantity"] = $("input#quantity")[0].value;
    setPrice("loading");
    $.post("{% url satchmo_product_prices product_slug=product.slug %}", opts, setNamePrice);
}

$(document).ready( function(){ getPrice();});
</script>
{% endblock %}

{% block navbar %}

<a href="{{ shop_base }}/">{% trans "Home" %}</a> 
{% for name, url in product.category.all.0.get_url_name %}
    ::<a href="{{ url }}">{{ name }}</a>
{% endfor %}

{% endblock %}

{% block content %}
<h4>{{ product.full_name }}</h4>
<p>{{ product.description }}</p>
{% trans "Price" %}: <h3 id="price">{{item.price}}</h3>
{% for pic in product.productimage_set.all %}
    <img src="{{ pic.get_picture_url|thumbnail:"width=280" }}" width="280" />
{% endfor %}

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
<form id="options" action="{% url satchmo_cart_add %}" method="post">
{% if options %}
<p>{% trans "Please choose your options" %}:</p>
{% endif %}

{% for option_group in options %}
 {{ option_group.name }}
    <select name="{{ option_group.id }}" id="{{option_group.id}}" onchange="getPrice()">
    {% for choice in option_group.items %}
     <option value="{{ choice.value }}" {% if choice.selected %}selected="selected"{% endif %}>{{ choice.name }}
        {% if choice.price_change %}
            {% option_price choice %}
        {% endif %}
     </option>
    {% endfor %}
      </select> 
{% endfor %} 
{% trans "Quantity" %} <input type="text", size="2", name="quantity" id="quantity" value=1 onchange="getPrice()" /> 
<input type="hidden" name="productname" id="productname" value="{{product.slug}}" />
<input type="submit" value="{% trans "Add to cart" %}" /> 
</form> 
{% endblock %} 
